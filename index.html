<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Escáner QR</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body style="font-family: Arial; text-align:center; margin-top:40px;">
    <h2>Escáner QR</h2>
    <div id="reader" style="width:300px; margin:auto;"></div>
    <div id="resultado" style="margin-top:20px; font-size:18px;"></div>

    <script>
        function onScanSuccess(decodedText) {
            document.getElementById("resultado").innerHTML = "Código detectado: " + decodedText;
            window.location.href = decodedText; 
        }

        const html5QrCode = new Html5Qrcode("reader");

        Html5Qrcode.getCameras()
        .then(devices => {
            if (devices.length > 0) {
                // Buscar la cámara trasera por su etiqueta o facingMode
                const backCamera = devices.find(d => 
                    d.label.toLowerCase().includes("back") || 
                    d.label.toLowerCase().includes("trasera") || 
                    d.label.toLowerCase().includes("environment")
                );

                const cameraToUse = backCamera ? backCamera.id : devices[0].id;

                html5QrCode.start(
                    cameraToUse,
                    {
                        fps: 10,
                        qrbox: 250
                    },
                    onScanSuccess
                );
            }
        })
        .catch(err => {
            document.getElementById("resultado").innerHTML = "Error al acceder a la cámara.";
        });
    </script>
</body>
</html>
